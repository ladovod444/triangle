/*
 *  Copyright 2025.  Baks.dev <admin@baks.dev>
 *  
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is furnished
 *  to do so, subject to the following conditions:
 *  
 *  The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *  
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NON INFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */

let formName=document.forms.category_product_form;let $addButtonSection=document.getElementById("section_addCollection");let $blockCollection=document.getElementById("section_collection");if($blockCollection){deleteSection($blockCollection);deleteField($blockCollection);let $addButtonField=document.querySelectorAll('[id^="createSectionField"]');$addButtonField.forEach(function(item){createSectionField(item.dataset.section)});$addButtonSection.addEventListener("click",function(){let newForm=this.dataset.prototype;let index=this.dataset.index*1;newForm=newForm.replace(/__category_section__/g,index);let div=document.createElement("div");div.id="item-collection-section-"+index;div.classList.add("card");div.classList.add("p-4");div.classList.add("mb-3");div.classList.add("border-light");div.classList.add("item-collection-section");div.innerHTML=newForm;$blockCollection.append(div);div.scrollIntoView({block:"center",inline:"center",behavior:"smooth"});createSectionField(index);deleteSection(div);deleteField(div);this.dataset.index=(index+1).toString();new NiceSelect(div.querySelector("#category_product_form_section_"+index+"_field_0_type"),{searchable:true})})}function deleteSection($block){let $delItem=$block.querySelectorAll(".del-item-section");$delItem.forEach(function(item){item.addEventListener("click",function(){let $counter=$block.getElementsByClassName("item-collection-section").length;if($counter>1){item.closest(".item-collection-section").remove()}else{alert("Минимально должна быть добавлена одна секция")}})})}function deleteField($block){$delItem=$block.querySelectorAll(".del-item-field");$delItem.forEach(function(item){item.addEventListener("click",function(){let $fieldCollection=document.getElementById("field-collection-"+this.dataset.section);let $counter=$fieldCollection.querySelectorAll(".item-collection-field").length;if($counter>1){item.closest(".item-collection-field").remove()}else{alert("Минимально должна быть добавлена одна секция")}})})}function createSectionField(section){let $btnAddFields=document.getElementById("createSectionField"+section);$btnAddFields.addEventListener("click",function(){let section_id=$btnAddFields.dataset.section;let newForm=$btnAddFields.dataset.prototype;let index=$btnAddFields.dataset.index;newForm=newForm.replace(/__category_section__/g,section_id);newForm=newForm.replace(/__section_field__/g,index);newForm=newForm.replace(/__FIELD_SORT__/g,index*10+100);let div=document.createElement("div");div.id="item-collection-field-"+index;div.classList.add("item-collection-field");div.classList.add("pb-3");div.innerHTML=newForm;document.getElementById("field-collection-"+section_id).append(div);div.scrollIntoView({block:"center",inline:"center",behavior:"smooth"});deleteField(div);$btnAddFields.dataset.index=(index*1+1).toString();new NiceSelect(div.querySelector("#category_product_form_section_"+section_id+"_field_"+index+"_type"),{searchable:true})})}document.querySelectorAll(".is-reference").forEach(function(isReference){chanfeReferenc(isReference);isReference.addEventListener("change",function(){chanfeReferenc(this)})});let $name=document.querySelector("input[data-lang='"+formName.name+"_translate_0_"+$locale+"']");executeFunc(function charUrlCode(){if($name===null){return false}if(typeof catUrl.debounce!=="function"){return false}$name.addEventListener("input",catUrl.debounce(500));return true});function catUrl(){let inputUrl=document.getElementById(formName.name+"_info_url");if(inputUrl===null){return}inputUrl.value=translitRuEn(this.value).toLowerCase()}function setupCheckboxGroup(namePart){const checkboxes=document.querySelectorAll(`input[type="checkbox"][name*="${namePart}"]`);if(checkboxes.length>0){checkboxes.forEach(function(item){item.addEventListener("change",function(){const currentCheck=this.id;checkboxes.forEach(function(event){if(event.id!==currentCheck){event.checked=false}})})})}}setupCheckboxGroup("price");setupCheckboxGroup("article");setupCheckboxGroup("quantitative");setupCheckboxGroup("image");$checkboxOfferSettings=document.getElementById(formName.name+"_offer_offer");$checkboxVariationSettings=document.getElementById(formName.name+"_offer_variation_variation");$checkboxModificationSettings=document.getElementById(formName.name+"_offer_variation_modification_modification");$nameOfferSettings=document.querySelectorAll("input[id^='"+formName.name+"_offer_translate']");$nameVariationSettings=document.querySelectorAll("input[id^='"+formName.name+"_offer_variation_translate']");$nameModificationSettings=document.querySelectorAll("input[id^='"+formName.name+"_offer_variation_modification_translate']");toggleSettings($checkboxOfferSettings);toggleSettings($checkboxVariationSettings);toggleSettings($checkboxModificationSettings);function toggleSettings(checkbox,children=null){let settingsContainer=document.getElementById(checkbox.id+"_settings");let inputElements;if(checkbox.id===$checkboxOfferSettings.id){inputElements=$nameOfferSettings}if(checkbox.id===$checkboxVariationSettings.id){inputElements=$nameVariationSettings}if(checkbox.id===$checkboxModificationSettings.id){inputElements=$nameModificationSettings}if(checkbox.checked){settingsContainer.classList.remove("d-none");Array.from(inputElements).forEach(input=>{if(!input.name.includes("postfix")){input.setAttribute("required",true)}});if(children){children.disabled=false}}else{settingsContainer.classList.add("d-none");if(checkbox.id===formName.name+"_offer_offer"){$checkboxVariationSettings.checked=false;$checkboxVariationSettings.chedisabledcked=true;toggleSettings($checkboxVariationSettings)}if(checkbox.id===$checkboxVariationSettings.id){$checkboxModificationSettings.checked=false;$checkboxModificationSettings.disabled=true;toggleSettings($checkboxModificationSettings)}Array.from(inputElements).forEach(input=>input.removeAttribute("required"))}}$checkboxOfferSettings.addEventListener("change",function(){toggleSettings(this,$checkboxVariationSettings)});$checkboxVariationSettings.addEventListener("change",function(){toggleSettings(this,$checkboxModificationSettings)});$checkboxModificationSettings.addEventListener("change",function(){toggleSettings(this)});function chanfeReferenc($this){let ref=document.getElementById($this.dataset.reference);if($this.checked===true){ref.classList.remove("d-none")}else{ref.classList.add("d-none");ref.selectedIndex=0}}document.querySelectorAll(".change-postfix").forEach(function(postfix){postfix.addEventListener("change",function(){document.querySelectorAll("."+this.id).forEach(function(element){if(postfix.checked===true){element.classList.remove("d-none");element.querySelector("input").setAttribute("required",true)}else{element.classList.add("d-none");let inpt=element.querySelector("input");inpt.removeAttribute("required");inpt.removeAttribute("value")}})})});document.querySelectorAll("#category_product_form-add").forEach(function(item){item.addEventListener("click",addDomain)});function addDomain(){let newForm=this.dataset.prototype;let index=this.dataset.index*1;let collection=this.dataset.collection;newForm=newForm.replace(/__category_domain__/g,index);let div=document.createElement("div");div.innerHTML=newForm;div.id="item_category_product_form_domain_"+index;div.classList.add("mb-3");let $collection=document.getElementById(collection);$collection.append(div);div.querySelector(".del-item-domain")?.addEventListener("click",deletePhone);this.dataset.index=(index+1).toString()}document.querySelectorAll(".del-item-domain").forEach(function(item){item.addEventListener("click",deletePhone)});function deletePhone(){document.getElementById(this.dataset.delete).remove()}