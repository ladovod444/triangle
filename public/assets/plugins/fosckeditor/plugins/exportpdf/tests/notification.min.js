(function(){bender.loadExternalPlugin("exportpdf","/apps/plugin/");CKEDITOR.plugins.load("exportpdf",function(){function a(e,d){var f=e._.notificationArea.notifications[0];assert.areSame(d.message,f.message,"Message should be the same.");assert.areSame(d.type,f.type,"Type should be the same.");assert.areSame(d.progress,f.progress,"Progress should be the same.")}bender.editors={successEditor:{config:exportPdfUtils.getDefaultConfig("unit")},errorEditor:{config:exportPdfUtils.getDefaultConfig("unit")}};bender.test({setUp:function(){bender.tools.ignoreUnsupportedEnvironment("exportpdf");sinon.stub(CKEDITOR.plugins.exportpdf,"downloadFile")},tearDown:function(){CKEDITOR.plugins.exportpdf.downloadFile.restore()},"test notifications and progress steps are correct in happy path":function(){var b=this.editors.successEditor;this.editorBots.successEditor.setHtmlWithSelection('\x3cp id\x3d"test"\x3eHello, World!\x3c/p\x3e^');b.once("exportPdf",function(){a(b,{message:"Processing PDF document...",type:"progress",progress:0})});b.once("exportPdf",function(){a(b,{message:"Processing PDF document...",type:"progress",progress:0.2})},null,null,16);exportPdfUtils.useXHR(b,function(c){c.addEventListener("progress",function(){a(b,{message:"Processing PDF document...",type:"progress",progress:0.8})});c.addEventListener("loadend",function(){a(b,{message:"Document is ready!",type:"success",progress:1})});c.respond(200,{},"")})},"test notifications and progress steps are correct in sad path":function(){var b=this.editors.errorEditor;this.editorBots.errorEditor.setHtmlWithSelection('\x3cp id\x3d"test"\x3eHello, World!\x3c/p\x3e^');exportPdfUtils.useXHR(b,function(c){var e=sinon.stub(console,"error",function(d){assert.areSame("Validation failed.",d.message,"Message from endpoint is incorrect.");e.restore()});c.addEventListener("loadend",function(){a(b,{message:"Error occurred.",type:"warning"})});c.respond(400,{},'{ "message": "Validation failed." }')})}})})})();