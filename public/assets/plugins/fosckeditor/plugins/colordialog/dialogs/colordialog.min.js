CKEDITOR.dialog.add("colordialog",function(f){function O(){Q.getById(L).removeStyle("background-color");N.getContentElement("picker","selectedColor").setValue("");c()}function b(d){d=d.data.getTarget();var e;"td"==d.getName()&&(e=d.getChild(0).getHtml())&&(c(),S=d,S.setAttribute("aria-selected",!0),S.addClass("cke_colordialog_selected"),N.getContentElement("picker","selectedColor").setValue(e))}function c(){S&&(S.removeClass("cke_colordialog_selected"),S.removeAttribute("aria-selected"),S=null)}function F(e){e=e.replace(/^#/,"");for(var g=0,d=[];2>=g;g++){d[g]=parseInt(e.substr(2*g,2),16)}return 165<=0.2126*d[0]+0.7152*d[1]+0.0722*d[2]}function a(e){!e.name&&(e=new CKEDITOR.event(e));var h=!/mouse/.test(e.name),d=e.data.getTarget(),g;"td"==d.getName()&&(g=d.getChild(0).getHtml())&&(J(e),h?T=d:K=d,h&&d.addClass(F(g)?"cke_colordialog_focused_light":"cke_colordialog_focused_dark"),H(g))}function I(){T&&(T.removeClass("cke_colordialog_focused_light"),T.removeClass("cke_colordialog_focused_dark"));H(!1);T=null}function J(d){if(d=!/mouse/.test(d.name)&&T){d.removeClass("cke_colordialog_focused_light"),d.removeClass("cke_colordialog_focused_dark")}T||K||H(!1)}function H(d){d?(Q.getById(o).setStyle("background-color",d),Q.getById(j).setHtml(d)):(Q.getById(o).removeStyle("background-color"),Q.getById(j).setHtml("\x26nbsp;"))}function s(g){var l=g.data,e=l.getTarget(),h=l.getKeystroke(),k="rtl"==f.lang.dir;switch(h){case 38:if(g=e.getParent().getPrevious()){g=g.getChild([e.getIndex()]),g.focus()}l.preventDefault();break;case 40:(g=e.getParent().getNext())&&(g=g.getChild([e.getIndex()]))&&1==g.type&&g.focus();l.preventDefault();break;case 32:case 13:b(g);l.preventDefault();break;case k?37:39:(g=e.getNext())?1==g.type&&(g.focus(),l.preventDefault(!0)):(g=e.getParent().getNext())&&(g=g.getChild([0]))&&1==g.type&&(g.focus(),l.preventDefault(!0));break;case k?39:37:if(g=e.getPrevious()){g.focus(),l.preventDefault(!0)}else{if(g=e.getParent().getPrevious()){g=g.getLast(),g.focus(),l.preventDefault(!0)}}}}var i=CKEDITOR.dom.element,Q=CKEDITOR.document,R=f.lang.colordialog,N,S,G={type:"html",html:"\x26nbsp;"},M=function(d){return CKEDITOR.tools.getNextId()+"_"+d},o=M("hicolor"),j=M("hicolortext"),L=M("selhicolor"),P,T,K;(function(){function h(p,v){for(var u=p;u<p+3;u++){var t=new i(P.$.insertRow(-1));t.setAttribute("role","row");for(var r=v;r<v+3;r++){for(var q=0;6>q;q++){n(t.$,"#"+g[r]+g[q]+g[u])}}}}function n(p,r){var e=new i(p.insertCell(-1));e.setAttribute("class","ColorCell cke_colordialog_colorcell");e.setAttribute("tabIndex",-1);e.setAttribute("role","gridcell");e.on("keydown",s);e.on("click",b);e.on("focus",a);e.on("blur",J);e.setStyle("background-color",r);var q=M("color_table_cell");e.setAttribute("aria-labelledby",q);e.append(CKEDITOR.dom.element.createFromHtml('\x3cspan id\x3d"'+q+'" class\x3d"cke_voice_label"\x3e'+r+"\x3c/span\x3e",CKEDITOR.document))}P=CKEDITOR.dom.element.createFromHtml('\x3ctable tabIndex\x3d"-1" class\x3d"cke_colordialog_table" aria-label\x3d"'+R.options+'" role\x3d"grid" style\x3d"border-collapse:separate;" cellspacing\x3d"0"\x3e\x3ccaption class\x3d"cke_voice_label"\x3e'+R.options+'\x3c/caption\x3e\x3ctbody role\x3d"presentation"\x3e\x3c/tbody\x3e\x3c/table\x3e');P.on("mouseover",a);P.on("mouseout",J);var g="00 33 66 99 cc ff".split(" ");h(0,0);h(3,0);h(0,3);h(3,3);var k=new i(P.$.insertRow(-1));k.setAttribute("role","row");n(k.$,"#000000");for(var m=0;16>m;m++){var l=m.toString(16);n(k.$,"#"+l+l+l+l+l+l)}n(k.$,"#ffffff")})();CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(CKEDITOR.plugins.get("colordialog").path+"dialogs/colordialog.css"));return{title:R.title,minWidth:360,minHeight:220,onShow:function(e){if(!e.data.selectionColor||e.data.selectionColor==e.data.automaticTextColor||"#rgba(0, 0, 0, 0)"==e.data.selectionColor&&"back"==e.data.type){O(),I()}else{var g=e.data.selectionColor;e=this.parts.contents.getElementsByTag("td").toArray();var d;N.getContentElement("picker","selectedColor").setValue(g);CKEDITOR.tools.array.forEach(e,function(h){d=CKEDITOR.tools.convertRgbToHex(h.getStyle("background-color"));g===d&&(h.focus(),T=h)})}},onLoad:function(){N=this},onHide:function(){O();I()},contents:[{id:"picker",label:R.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"\x3cdiv\x3e\x3c/div\x3e",onLoad:function(){CKEDITOR.document.getById(this.domId).append(P)},focus:function(){(T||this.getElement().getElementsByTag("td").getItem(0)).focus()}},G,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"\x3cspan\x3e"+R.highlight+'\x3c/span\x3e\x3cdiv id\x3d"'+o+'" style\x3d"border: 1px solid; height: 74px; width: 74px;"\x3e\x3c/div\x3e\x3cdiv id\x3d"'+j+'"\x3e\x26nbsp;\x3c/div\x3e\x3cspan\x3e'+R.selected+'\x3c/span\x3e\x3cdiv id\x3d"'+L+'" style\x3d"border: 1px solid; height: 20px; width: 74px;"\x3e\x3c/div\x3e'},{type:"text",label:R.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 76px;margin-top:4px",onChange:function(){try{Q.getById(L).setStyle("background-color",this.getValue())}catch(d){O()}}},G,{type:"button",id:"clear",label:R.clear,onClick:O}]}]}]}]}});