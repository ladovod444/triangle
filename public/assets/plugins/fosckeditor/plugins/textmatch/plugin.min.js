"use strict";(function(){CKEDITOR.plugins.add("textmatch",{});CKEDITOR.plugins.textMatch={};CKEDITOR.plugins.textMatch.match=function(d,h){var f=CKEDITOR.plugins.textMatch.getTextAndOffset(d),g=CKEDITOR.dom.selection.FILLING_CHAR_SEQUENCE,e=0;if(!f){return}if(f.text.indexOf(g)==0){e=g.length;f.text=f.text.replace(g,"");f.offset-=e}var c=h(f.text,f.offset);if(!c){return null}return{range:CKEDITOR.plugins.textMatch.getRangeInText(d,c.start,c.end+e),text:f.text.slice(c.start,c.end)}};CKEDITOR.plugins.textMatch.getTextAndOffset=function(j){if(!j.collapsed){return null}var m="",g=0,k=CKEDITOR.plugins.textMatch.getAdjacentTextNodes(j),e=false,f,c=(j.startContainer.type!=CKEDITOR.NODE_ELEMENT);if(c){f=a(k,function(i){return j.startContainer.equals(i)})}else{f=j.startOffset-(k[0]?k[0].getIndex():0)}var l=k.length;for(var h=0;h<l;h+=1){var d=k[h];m+=d.getText();if(!e){if(c){if(h==f){e=true;g+=j.startOffset}else{g+=d.getText().length}}else{if(h==f){e=true}if(h>0){g+=k[h-1].getText().length}if(l==f&&h+1==l){g+=d.getText().length}}}}return{text:m,offset:g}};CKEDITOR.plugins.textMatch.getRangeInText=function(e,i,d){var h=new CKEDITOR.dom.range(e.root),g=CKEDITOR.plugins.textMatch.getAdjacentTextNodes(e),f=b(g,i),c=b(g,d);h.setStart(f.element,f.offset);h.setEnd(c.element,c.offset);return h};CKEDITOR.plugins.textMatch.getAdjacentTextNodes=function(c){if(!c.collapsed){throw new Error("Range must be collapsed.");return[]}var h=[],g,e,f,d;if(c.startContainer.type!=CKEDITOR.NODE_ELEMENT){g=c.startContainer.getParent().getChildren();e=c.startContainer.getIndex()}else{g=c.startContainer.getChildren();e=c.startOffset}d=e;while(f=g.getItem(--d)){if(f.type==CKEDITOR.NODE_TEXT){h.unshift(f)}else{break}}d=e;while(f=g.getItem(d++)){if(f.type==CKEDITOR.NODE_TEXT){h.push(f)}else{break}}return h};function b(f,h){var c=f.length,e=0;for(var d=0;d<c;d+=1){var g=f[d];if(h>=e&&e+g.getText().length>=h){return{element:g,offset:h-e}}e+=g.getText().length}return null}function a(c,d){for(var e=0;e<c.length;e++){if(d(c[e])){return e}}return -1}})();