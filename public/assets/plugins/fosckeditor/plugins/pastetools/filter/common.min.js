(function(){function b(k,g,n){g+=n;for(var m=k[g],l=/[\s]/;m&&l.test(m);){g+=n,m=k[g]}return m}function a(g){return/%$/.test(g)?g:g+"px"}function j(k){var g=k.margin?"margin":k.MARGIN?"MARGIN":!1,m,l;if(g){l=CKEDITOR.tools.style.parse.margin(k[g]);for(m in l){k["margin-"+m]=l[m]}delete k[g]}}function i(k){var g="background-color:transparent;background:transparent;background-color:none;background:none;background-position:initial initial;background-repeat:initial initial;caret-color;font-family:-webkit-standard;font-variant-caps;letter-spacing:normal;orphans;widows;text-transform:none;word-spacing:0px;-webkit-text-size-adjust:auto;-webkit-text-stroke-width:0px;text-indent:0px;margin-bottom:0in".split(";"),n=CKEDITOR.tools.parseCssText(k.attributes.style),m,l;for(m in n){l=m+":"+n[m],CKEDITOR.tools.array.some(g,function(o){return l.substring(0,o.length).toLowerCase()===o})&&delete n[m]}n=CKEDITOR.tools.writeCssText(n);""!==n?k.attributes.style=n:delete k.attributes.style}function h(k){k=k.config.font_names;var g=[];if(!k||!k.length){return !1}g=CKEDITOR.tools.array.map(k.split(";"),function(l){return -1===l.indexOf("/")?l:l.split("/")[1]});return g.length?g:!1}function f(k,g){var l=k.split(",");return CKEDITOR.tools.array.find(g,function(m){for(var n=0;n<l.length;n++){if(-1===m.indexOf(CKEDITOR.tools.trim(l[n]))){return !1}}return !0})||k}var e,d=CKEDITOR.tools,c={};CKEDITOR.plugins.pastetools.filters.common=c;c.rules=function(k,g,m){var l=h(g);return{elements:{"^":function(o){i(o);if(o.attributes.bgcolor){var n=CKEDITOR.tools.parseCssText(o.attributes.style);n["background-color"]||(n["background-color"]=o.attributes.bgcolor,o.attributes.style=CKEDITOR.tools.writeCssText(n))}},span:function(n){if(n.hasClass("Apple-converted-space")){return new CKEDITOR.htmlParser.text(" ")}},table:function(o){o.filterChildren(m);var n=o.parent,q=n&&n.parent,r,p;if(n.name&&"div"===n.name&&n.attributes.align&&1===d.object.keys(n.attributes).length&&1===n.children.length){o.attributes.align=n.attributes.align;r=n.children.splice(0);o.remove();for(p=r.length-1;0<=p;p--){q.add(r[p],n.getIndex())}n.remove()}e.convertStyleToPx(o)},tr:function(n){n.attributes={}},td:function(p){var s=p.getAscendant("table"),s=d.parseCssText(s.attributes.style,!0),r=s.background;r&&e.setStyle(p,"background",r,!0);(s=s["background-color"])&&e.setStyle(p,"background-color",s,!0);var s=d.parseCssText(p.attributes.style,!0),r=s.border?CKEDITOR.tools.style.border.fromCssRule(s.border):{},r=d.style.border.splitCssValues(s,r),o=CKEDITOR.tools.clone(s),q;for(q in o){0==q.indexOf("border")&&delete o[q]}p.attributes.style=CKEDITOR.tools.writeCssText(o);s.background&&(q=CKEDITOR.tools.style.parse.background(s.background),q.color&&(e.setStyle(p,"background-color",q.color,!0),e.setStyle(p,"background","")));for(var t in r){q=s[t]?CKEDITOR.tools.style.border.fromCssRule(s[t]):r[t],"none"===q.style?e.setStyle(p,t,"none"):e.setStyle(p,t,q.toString())}e.mapCommonStyles(p);e.convertStyleToPx(p);e.createStyleStack(p,m,g,/margin|text\-align|padding|list\-style\-type|width|height|border|white\-space|vertical\-align|background/i)},font:function(n){n.attributes.face&&l&&(n.attributes.face=f(n.attributes.face,l))}}}};c.styles={setStyle:function(k,g,n,m){var l=d.parseCssText(k.attributes.style);m&&l[g]||(""===n?delete l[g]:l[g]=n,k.attributes.style=CKEDITOR.tools.writeCssText(l))},convertStyleToPx:function(k){var g=k.attributes.style;g&&(k.attributes.style=g.replace(/\d+(\.\d+)?pt/g,function(l){return CKEDITOR.tools.convertToPx(l)+"px"}))},mapStyles:function(k,g){for(var l in g){if(k.attributes[l]){if("function"===typeof g[l]){g[l](k.attributes[l])}else{e.setStyle(k,g[l],k.attributes[l])}delete k.attributes[l]}}},mapCommonStyles:function(g){return e.mapStyles(g,{vAlign:function(k){e.setStyle(g,"vertical-align",k)},width:function(k){e.setStyle(g,"width",a(k))},height:function(k){e.setStyle(g,"height",a(k))}})},normalizedStyles:function(B,A){var z="background-color:transparent border-image:none color:windowtext direction:ltr mso- visibility:visible div:border:none".split(" "),y="font-family font font-size color background-color line-height text-decoration".split(" "),x=function(){for(var k=[],g=0;g<arguments.length;g++){arguments[g]&&k.push(arguments[g])}return -1!==d.indexOf(z,k.join(":"))},t=!0===CKEDITOR.plugins.pastetools.getConfigValue(A,"removeFontStyles"),w=d.parseCssText(B.attributes.style);"cke:li"==B.name&&(w["TEXT-INDENT"]&&w.MARGIN?(B.attributes["cke-indentation"]=c.lists.getElementIndentation(B),w.MARGIN=w.MARGIN.replace(/(([\w\.]+ ){3,3})[\d\.]+(\w+$)/,"$10$3")):delete w["TEXT-INDENT"],delete w["text-indent"]);for(var s=d.object.keys(w),u=0;u<s.length;u++){var p=s[u].toLowerCase(),v=w[s[u]],o=CKEDITOR.tools.indexOf;(t&&-1!==o(y,p.toLowerCase())||x(null,p,v)||x(null,p.replace(/\-.*$/,"-"))||x(null,p)||x(B.name,p,v)||x(B.name,p.replace(/\-.*$/,"-"))||x(B.name,p)||x(v))&&delete w[s[u]]}var m=CKEDITOR.plugins.pastetools.getConfigValue(A,"keepZeroMargins");j(w);(function(){CKEDITOR.tools.array.forEach(["top","right","bottom","left"],function(k){k="margin-"+k;if(k in w){var g=CKEDITOR.tools.convertToPx(w[k]);g||m?w[k]=g?g+"px":0:delete w[k]}})})();return CKEDITOR.tools.writeCssText(w)},createStyleStack:function(n,g,s,r){var q=[];n.filterChildren(g);for(g=n.children.length-1;0<=g;g--){q.unshift(n.children[g]),n.children[g].remove()}e.sortStyles(n);g=d.parseCssText(e.normalizedStyles(n,s));s=n;var o="span"===n.name,p;for(p in g){if(!p.match(r||/margin((?!-)|-left|-top|-bottom|-right)|text-indent|text-align|width|border|padding/i)){if(o){o=!1}else{var m=new CKEDITOR.htmlParser.element("span");m.attributes.style=p+":"+g[p];s.add(m);s=m;delete g[p]}}}CKEDITOR.tools.isEmpty(g)?delete n.attributes.style:n.attributes.style=CKEDITOR.tools.writeCssText(g);for(g=0;g<q.length;g++){s.add(q[g])}},sortStyles:function(l){for(var g=["border","border-bottom","font-size","background"],q=d.parseCssText(l.attributes.style),p=d.object.keys(q),o=[],m=[],n=0;n<p.length;n++){-1!==d.indexOf(g,p[n].toLowerCase())?o.push(p[n]):m.push(p[n])}o.sort(function(k,t){var s=d.indexOf(g,k.toLowerCase()),r=d.indexOf(g,t.toLowerCase());return s-r});p=[].concat(o,m);o={};for(n=0;n<p.length;n++){o[p[n]]=q[p[n]]}l.attributes.style=CKEDITOR.tools.writeCssText(o)},pushStylesLower:function(v,u,t){if(!v.attributes.style||0===v.children.length){return !1}u=u||{};var s={"list-style-type":!0,width:!0,height:!0,border:!0,"border-":!0},r=d.parseCssText(v.attributes.style),o;for(o in r){if(!(o.toLowerCase() in s||s[o.toLowerCase().replace(/\-.*$/,"-")]||o.toLowerCase() in u)){for(var q=!1,m=0;m<v.children.length;m++){var p=v.children[m];if(p.type===CKEDITOR.NODE_TEXT&&t){var g=new CKEDITOR.htmlParser.element("span");g.setHtml(p.value);p.replaceWith(g);p=g}p.type===CKEDITOR.NODE_ELEMENT&&(q=!0,e.setStyle(p,o,r[o]))}q&&delete r[o]}}v.attributes.style=CKEDITOR.tools.writeCssText(r);return !0},inliner:{filtered:"break-before break-after break-inside page-break page-break-before page-break-after page-break-inside".split(" "),parse:function(l){function g(r){var k=new CKEDITOR.dom.element("style"),s=new CKEDITOR.dom.element("iframe");s.hide();CKEDITOR.document.getBody().append(s);s.$.contentDocument.documentElement.appendChild(k.$);k.$.textContent=r;s.remove();return k.$.sheet}function q(r){var k=r.indexOf("{"),s=r.indexOf("}");return p(r.substring(k+1,s),!0)}var p=CKEDITOR.tools.parseCssText,o=e.inliner.filter,m=l.is?l.$.sheet:g(l);l=[];var n;if(m){for(m=m.cssRules,n=0;n<m.length;n++){m[n].type===window.CSSRule.STYLE_RULE&&l.push({selector:m[n].selectorText,styles:o(q(m[n].cssText))})}}return l},filter:function(k){var g=e.inliner.filtered,n=d.array.indexOf,m={},l;for(l in k){-1===n(g,l)&&(m[l]=k[l])}return m},sort:function(g){return g.sort(function(k){var l=CKEDITOR.tools.array.map(k,function(m){return m.selector});return function(n,m){var o=-1!==(""+n.selector).indexOf(".")?1:0,o=(-1!==(""+m.selector).indexOf(".")?1:0)-o;return 0!==o?o:l.indexOf(m.selector)-l.indexOf(n.selector)}}(g))},inline:function(k){var g=e.inliner.parse,m=e.inliner.sort,l=function(n){n=(new DOMParser).parseFromString(n,"text/html");return new CKEDITOR.dom.document(n)}(k);k=l.find("style");m=m(function(n){var p=[],o;for(o=0;o<n.count();o++){p=p.concat(g(n.getItem(o)))}return p}(k));CKEDITOR.tools.array.forEach(m,function(o){var n=o.styles;o=l.find(o.selector);var r,q,p;j(n);for(p=0;p<o.count();p++){r=o.getItem(p),q=CKEDITOR.tools.parseCssText(r.getAttribute("style")),j(q),q=CKEDITOR.tools.extend({},q,n),r.setAttribute("style",CKEDITOR.tools.writeCssText(q))}});return l}}};e=c.styles;c.lists={getElementIndentation:function(k){k=d.parseCssText(k.attributes.style);if(k.margin||k.MARGIN){k.margin=k.margin||k.MARGIN;var g={styles:{margin:k.margin}};CKEDITOR.filter.transformationsTools.splitMarginShorthand(g);k["margin-left"]=g.styles["margin-left"]}return parseInt(d.convertToPx(k["margin-left"]||"0px"),10)}};c.elements={replaceWithChildren:function(k){for(var g=k.children.length-1;0<=g;g--){k.children[g].insertAfter(k)}}};c.createAttributeStack=function(n,k){var s,r=[];n.filterChildren(k);for(s=n.children.length-1;0<=s;s--){r.unshift(n.children[s]),n.children[s].remove()}s=n.attributes;var q=n,o=!0,p;for(p in s){if(o){o=!1}else{var m=new CKEDITOR.htmlParser.element(n.name);m.attributes[p]=s[p];q.add(m);q=m;delete s[p]}}for(s=0;s<r.length;s++){q.add(r[s])}};c.parseShorthandMargins=j;c.rtf={getGroups:function(k,g){for(var n=[],m,l=0;m=c.rtf.getGroup(k,g,{start:l});){l=m.end,n.push(m)}return n},removeGroups:function(k,g){for(var m;m=c.rtf.getGroup(k,g);){var l=k.substring(0,m.start);m=k.substring(m.end);k=l+m}return k},getGroup:function(l,k,p){var o=0;k=new RegExp("\\{\\\\"+k,"g");var n;p=CKEDITOR.tools.object.merge({start:0},p||{});k.lastIndex=p.start;p=k.exec(l);if(!p){return null}k=p.index;n=l[k];do{var m="{"===n&&"\\"!==b(l,k,-1)&&"\\"===b(l,k,1);n="}"===n&&"\\"!==b(l,k,-1)&&0<o;m?o++:n&&o--;n=l[++k]}while(n&&0<o);return{start:p.index,end:k,content:l.substring(p.index,k)}},extractGroupContent:function(k){var g;g=(g=k.match(/^\{\\(\w+)/))?g[1]:null;k=k.replace(/\}([^{\s]+)/g,"} $1");k=c.rtf.removeGroups(k,"(?!"+g+")");k=CKEDITOR.tools.trim(k.replace(/^\{(\\[\w-]+\s*)+/g,""));return k.replace(/}$/,"")}}})();