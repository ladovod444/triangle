"use strict";(function(){CKEDITOR.plugins.add("textwatcher",{});function a(b,e,c){this.editor=b;this.lastMatched=null;this.ignoreNext=false;this.callback=e;this.ignoredKeys=[16,17,18,91,35,36,37,38,39,40,33,34];this._listeners=[];this.throttle=c||0;this._buffer=CKEDITOR.tools.throttle(this.throttle,d,this);function d(g){var f=this.callback(g);if(f){if(f.text==this.lastMatched){return}this.lastMatched=f.text;this.fire("matched",f)}else{if(this.lastMatched){this.unmatch()}}}}a.prototype={attach:function(){var d=this.editor;this._listeners.push(d.on("contentDom",e,this));this._listeners.push(d.on("blur",c,this));this._listeners.push(d.on("beforeModeUnload",c,this));this._listeners.push(d.on("setData",c,this));this._listeners.push(d.on("afterCommandExec",c,this));if(d.editable()){e.call(this)}return this;function e(){var f=d.editable();this._listeners.push(f.attachListener(f,"keyup",b,this))}function b(f){this.check(f)}function c(){this.unmatch()}},check:function(b){if(this.ignoreNext){this.ignoreNext=false;return}if(b&&b.name=="keyup"&&(CKEDITOR.tools.array.indexOf(this.ignoredKeys,b.data.getKey())!=-1)){return}var c=this.editor.getSelection();if(!c){return}var d=c.getRanges()[0];if(!d){return}this._buffer.input(d)},consumeNext:function(){this.ignoreNext=true;return this},unmatch:function(){this.lastMatched=null;this.fire("unmatched");return this},destroy:function(){CKEDITOR.tools.array.forEach(this._listeners,function(b){b.removeListener()});this._listeners=[]}};CKEDITOR.event.implementOn(a.prototype);CKEDITOR.plugins.textWatcher=a})();