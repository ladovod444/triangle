(function(){function f(g){return g.type==CKEDITOR.NODE_TEXT&&0<g.getLength()&&(!b||!g.isReadOnly())}function d(g){return !(g.type==CKEDITOR.NODE_ELEMENT&&g.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}var b,c=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},a=["find","replace"],e=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]];CKEDITOR.dialog.add("find",function(m){function j(r,n){var t=this,u=new CKEDITOR.dom.walker(r);u.guard=n?d:function(v){!d(v)&&(t._.matchBoundary=!0)};u.evaluator=f;u.breakOnFalse=1;r.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=r.startContainer,this.offset=r.startOffset-1);this._={matchWord:n,walker:u,matchBoundary:!1}}function p(r,n){var t=m.createRange();t.setStart(r.textNode,n?r.offset:r.offset+1);t.setEndAt(m.editable(),CKEDITOR.POSITION_BEFORE_END);return t}function g(r){var n=m.getSelection().getRanges()[0],t=m.editable();n&&!r?(r=n.clone(),r.collapse(!0)):(r=m.createRange(),r.setStartAt(t,CKEDITOR.POSITION_AFTER_START));r.setEndAt(t,CKEDITOR.POSITION_BEFORE_END);return r}var o=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},m.config.find_highlight,!0));j.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(r){var n=this.textNode;if(null===n){return c.call(this)}this._.matchBoundary=!1;if(n&&r&&0<this.offset){this.offset--}else{if(n&&this.offset<n.getLength()-1){this.offset++}else{for(n=null;!n&&!(n=this._.walker[r?"previous":"next"].call(this._.walker),this._.matchWord&&!n||this._.walker._.end);){}this.offset=(this.textNode=n)?r?n.getLength()-1:0:0}}return c.call(this)}};var q=function(r,n){this._={walker:r,cursors:[],rangeLength:n,highlightRange:null,isMatched:0}};q.prototype={toDomRange:function(){var r=m.createRange(),n=this._.cursors;if(1>n.length){var t=this._.walker.textNode;if(t){r.setStartAfter(t)}else{return null}}else{t=n[0],n=n[n.length-1],r.setStart(t.textNode,t.offset),r.setEnd(n.textNode,n.offset+1)}return r},updateFromDomRange:function(r){var n=new j(r);this._.cursors=[];do{r=n.next(),r.character&&this._.cursors.push(r)}while(r.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var r=this.toDomRange(),n=r.createBookmark();o.applyToRange(r,m);r.moveToBookmark(n);this._.highlightRange=r;n=r.startContainer;n.type!=CKEDITOR.NODE_ELEMENT&&(n=n.getParent());n.scrollIntoView();this.updateFromDomRange(r)}},removeHighlight:function(){if(this._.highlightRange){var n=this._.highlightRange.createBookmark();o.removeFromRange(this._.highlightRange,m);this._.highlightRange.moveToBookmark(n);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return this._.highlightRange?this._.highlightRange.startContainer.isReadOnly():0},moveBack:function(){var r=this._.walker.back(),n=this._.cursors;r.hitMatchBoundary&&(this._.cursors=n=[]);n.unshift(r);n.length>this._.rangeLength&&n.pop();return r},moveNext:function(){var r=this._.walker.next(),n=this._.cursors;r.hitMatchBoundary&&(this._.cursors=n=[]);n.push(r);n.length>this._.rangeLength&&n.shift();return r},getEndCharacter:function(){var n=this._.cursors;return 1>n.length?null:n[n.length-1].character},getNextCharacterRange:function(r){var n,t;t=this._.cursors;t=(n=t[t.length-1])&&n.textNode?new j(p(n)):this._.walker;return new q(t,r)},getCursors:function(){return this._.cursors}};var i=function(r,n){var t=[-1];n&&(r=r.toLowerCase());for(var u=0;u<r.length;u++){for(t.push(t[u]+1);0<t[u+1]&&r.charAt(u)!=r.charAt(t[u+1]-1);){t[u+1]=t[t[u+1]-1]+1}}this._={overlap:t,state:0,ignoreCase:!!n,pattern:r}};i.prototype={feedCharacter:function(n){for(this._.ignoreCase&&(n=n.toLowerCase());;){if(n==this._.pattern.charAt(this._.state)){return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1}if(this._.state){this._.state=this._.overlap[this._.state]}else{return 0}}},reset:function(){this._.state=0}};var s=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,h=function(r){if(!r){return !0}var n=r.charCodeAt(0);return 9<=n&&13>=n||8192<=n&&8202>=n||s.test(r)},k={searchRange:null,matchRange:null,find:function(C,B,A,z,n,E){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(C.length)):this.matchRange=new q(new j(this.searchRange),C.length);for(var x=new i(C,!B),w=0,v="%";null!==v;){for(this.matchRange.moveNext();v=this.matchRange.getEndCharacter();){w=x.feedCharacter(v);if(2==w){break}this.matchRange.moveNext().hitMatchBoundary&&x.reset()}if(2==w){if(A){var y=this.matchRange.getCursors(),r=y[y.length-1],y=y[0],t=m.createRange();t.setStartAt(m.editable(),CKEDITOR.POSITION_AFTER_START);t.setEnd(y.textNode,y.offset);y=t;r=p(r);y.trim();r.trim();y=new j(y,!0);r=new j(r,!0);if(!h(y.back().character)||!h(r.next().character)){continue}}this.matchRange.setMatched();!1!==n&&this.matchRange.highlight();return !0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return z&&!E?(this.searchRange=g(1),this.matchRange=null,k.find.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(r,n,z,y,x,v,w){b=1;r=0;r=this.hasMatchOptionsChanged(n,y,x);if(!this.matchRange||!this.matchRange.isMatched()||this.matchRange._.isReplaced||this.matchRange.isReadOnly()||r){r&&this.matchRange&&(this.matchRange.clearMatched(),this.matchRange.removeHighlight(),this.matchRange=null),r=this.find(n,y,x,v,!w)}else{this.matchRange.removeHighlight();n=this.matchRange.toDomRange();z=m.document.createText(z);if(!w){var t=m.getSelection();t.selectRanges([n]);m.fire("saveSnapshot")}n.deleteContents();n.insertNode(z);w||(t.selectRanges([n]),m.fire("saveSnapshot"));this.matchRange.updateFromDomRange(n);w||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;r=1}b=0;return r},matchOptions:null,hasMatchOptionsChanged:function(r,n,t){r=[r,n,t].join(".");n=this.matchOptions&&this.matchOptions!=r;this.matchOptions=r;return n}},l=m.lang.find;return{title:l.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton(m,{label:m.lang.common.close})],contents:[{id:"find",label:l.find,title:l.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:l.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:l.find,onClick:function(){var n=this.getDialog();k.find(n.getValueOf("find","txtFindFind"),n.getValueOf("find","txtFindCaseChk"),n.getValueOf("find","txtFindWordChk"),n.getValueOf("find","txtFindCyclic"))||alert(l.notFoundMsg)}}]},{type:"fieldset",className:"cke_dialog_find_fieldset",label:CKEDITOR.tools.htmlEncode(l.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:l.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:l.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:l.matchCyclic}]}]}]},{id:"replace",label:l.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:l.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:l.replace,onClick:function(){var n=this.getDialog();k.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),n.getValueOf("replace","txtReplaceCyclic"))||alert(l.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:l.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:l.replaceAll,isChanged:!1,onClick:function(){var n=this.getDialog();k.replaceCounter=0;k.searchRange=g(1);k.matchRange&&(k.matchRange.removeHighlight(),k.matchRange=null);for(m.fire("saveSnapshot");k.replace(n,n.getValueOf("replace","txtFindReplace"),n.getValueOf("replace","txtReplace"),n.getValueOf("replace","txtReplaceCaseChk"),n.getValueOf("replace","txtReplaceWordChk"),!1,!0);){}k.replaceCounter?(alert(l.replaceSuccessMsg.replace(/%1/,k.replaceCounter)),m.fire("saveSnapshot")):alert(l.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(l.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:l.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:l.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:l.matchCyclic}]}]}]}],onLoad:function(){var r=this,n,t=0;this.on("hide",function(){t=0});this.on("show",function(){t=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(u){return function(A){u.call(r,A);var z=r._.tabs[A],x;x="find"===A?"txtFindWordChk":"txtReplaceWordChk";n=r.getContentElement(A,"find"===A?"txtFindFind":"txtFindReplace");r.getContentElement(A,x);z.initialized||(CKEDITOR.document.getById(n._.inputId),z.initialized=!0);if(t){var w;A="find"===A?1:0;var z=1-A,v,y=e.length;for(v=0;v<y;v++){x=this.getContentElement(a[A],e[v][A]),w=this.getContentElement(a[z],e[v][z]),w.setValue(x.getValue())}}}})},onShow:function(){k.searchRange=g();var r=this._.currentTabId,n=this.getParentEditor().getSelection().getSelectedText(),t=this.getContentElement(r,"find"==r?"txtFindFind":"txtFindReplace");t.setValue(n);t.select();this[("find"==r&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var n;k.matchRange&&k.matchRange.isMatched()&&(k.matchRange.removeHighlight(),(n=k.matchRange.toDomRange())&&m.getSelection().selectRanges([n]),m.focus());delete k.matchRange},onFocus:function(){return"replace"==this._.currentTabId?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}})})();