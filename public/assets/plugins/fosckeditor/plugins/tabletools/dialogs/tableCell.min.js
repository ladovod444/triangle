CKEDITOR.dialog.add("cellProperties",function(F){function E(d){return{isSpacer:!0,type:"html",html:"\x26nbsp;",requiredContent:d?d:void 0}}function s(){return{type:"vbox",padding:0,children:[]}}function o(d){return{requiredContent:"td{"+d+"}",type:"hbox",widths:["70%","30%"],children:[{type:"text",id:d,width:"100px",label:I[d],validate:B.number(J["invalid"+CKEDITOR.tools.capitalize(d)]),onLoad:function(){var e=this.getDialog().getContentElement("info",d+"Type").getElement(),g=this.getInputElement(),f=g.getAttribute("aria-labelledby");g.setAttribute("aria-labelledby",[f,e.$.id].join(" "))},setup:H(function(e){var f=parseFloat(e.getAttribute(d),10);e=parseFloat(e.getStyle(d),10);if(!isNaN(e)){return e}if(!isNaN(f)){return f}}),commit:function(e){var g=parseFloat(this.getValue(),10),f=this.getDialog().getValueOf("info",d+"Type")||j(e,d);isNaN(g)?e.removeStyle(d):e.setStyle(d,g+f);e.removeAttribute(d)},"default":""},{type:"select",id:d+"Type",label:F.lang.table[d+"Unit"],labelStyle:"visibility:hidden;display:block;width:0;overflow:hidden","default":"px",items:[[A.widthPx,"px"],[A.widthPc,"%"]],setup:H(function(e){return j(e,d)})}]}}function H(d){return function(e){for(var g=d(e[0]),f=1;f<e.length;f++){if(d(e[f])!==g){g=null;break}}"undefined"!=typeof g&&(this.setValue(g),CKEDITOR.env.gecko&&"select"==this.type&&!g&&(this.getInputElement().$.selectedIndex=-1))}}function j(e,d){var f=/^(\d+(?:\.\d+)?)(px|%)$/.exec(e.getStyle(d)||e.getAttribute(d));if(f){return f[2]}}function i(e,d){F.getColorFromDialog(function(f){f&&e.getDialog().getContentElement("info",d).setValue(f);e.focus()},e)}function c(e,d,f){(e=e.getValue())?d.setStyle(f,e):d.removeStyle(f);"background-color"==f?d.removeAttribute("bgColor"):"border-color"==f&&d.removeAttribute("borderColor")}var A=F.lang.table,J=A.cell,I=F.lang.common,B=CKEDITOR.dialog.validate,a="rtl"==F.lang.dir,D=F.plugins.colordialog,z=[o("width"),o("height"),E(["td{width}","td{height}"]),{type:"select",id:"wordWrap",requiredContent:"td{white-space}",label:J.wordWrap,"default":"yes",items:[[J.yes,"yes"],[J.no,"no"]],setup:H(function(e){var d=e.getAttribute("noWrap");if("nowrap"==e.getStyle("white-space")||d){return"no"}}),commit:function(d){"no"==this.getValue()?d.setStyle("white-space","nowrap"):d.removeStyle("white-space");d.removeAttribute("noWrap")}},E("td{white-space}"),{type:"select",id:"hAlign",requiredContent:"td{text-align}",label:J.hAlign,"default":"",items:[[I.notSet,""],[I.left,"left"],[I.center,"center"],[I.right,"right"],[I.justify,"justify"]],setup:H(function(e){var d=e.getAttribute("align");return e.getStyle("text-align")||d||""}),commit:function(e){var d=this.getValue();d?e.setStyle("text-align",d):e.removeStyle("text-align");e.removeAttribute("align")}},{type:"select",id:"vAlign",requiredContent:"td{vertical-align}",label:J.vAlign,"default":"",items:[[I.notSet,""],[I.alignTop,"top"],[I.alignMiddle,"middle"],[I.alignBottom,"bottom"],[J.alignBaseline,"baseline"]],setup:H(function(e){var d=e.getAttribute("vAlign");e=e.getStyle("vertical-align");switch(e){case"top":case"middle":case"bottom":case"baseline":break;default:e=""}return e||d||""}),commit:function(e){var d=this.getValue();d?e.setStyle("vertical-align",d):e.removeStyle("vertical-align");e.removeAttribute("vAlign")}},E(["td{text-align}","td{vertical-align}"]),{type:"select",id:"cellType",requiredContent:"th",label:J.cellType,"default":"td",items:[[J.data,"td"],[J.header,"th"]],setup:H(function(d){return d.getName()}),commit:function(d){d.renameNode(this.getValue())}},E("th"),{type:"text",id:"rowSpan",requiredContent:"td[rowspan]",label:J.rowSpan,"default":"",validate:B.integer(J.invalidRowSpan),setup:H(function(d){if((d=parseInt(d.getAttribute("rowSpan"),10))&&1!=d){return d}}),commit:function(e){var d=parseInt(this.getValue(),10);d&&1!=d?e.setAttribute("rowSpan",this.getValue()):e.removeAttribute("rowSpan")}},{type:"text",id:"colSpan",requiredContent:"td[colspan]",label:J.colSpan,"default":"",validate:B.integer(J.invalidColSpan),setup:H(function(d){if((d=parseInt(d.getAttribute("colSpan"),10))&&1!=d){return d}}),commit:function(e){var d=parseInt(this.getValue(),10);d&&1!=d?e.setAttribute("colSpan",this.getValue()):e.removeAttribute("colSpan")}},E(["td[colspan]","td[rowspan]"]),{type:"hbox",padding:0,widths:D?["60%","40%"]:["100%"],requiredContent:"td{background-color}",children:function(){var d=[{type:"text",id:"bgColor",label:J.bgColor,"default":"",setup:H(function(e){var f=e.getAttribute("bgColor");return e.getStyle("background-color")||f}),commit:function(e){c(this,e,"background-color")}}];D&&d.push({type:"button",id:"bgColorChoose","class":"colorChooser",label:J.chooseColor,onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom")},onClick:function(){i(this,"bgColor")}});return d}()},{type:"hbox",padding:0,widths:D?["60%","40%"]:["100%"],requiredContent:"td{border-color}",children:function(){var d=[{type:"text",id:"borderColor",label:J.borderColor,"default":"",setup:H(function(e){var f=e.getAttribute("borderColor");return e.getStyle("border-color")||f}),commit:function(e){c(this,e,"border-color")}}];D&&d.push({type:"button",id:"borderColorChoose","class":"colorChooser",label:J.chooseColor,style:(a?"margin-right":"margin-left")+": 10px",onLoad:function(){this.getElement().getParent().setStyle("vertical-align","bottom")},onClick:function(){i(this,"borderColor")}});return d}()}],C=0,b=-1,G=[s()],z=CKEDITOR.tools.array.filter(z,function(e){var d=e.requiredContent;delete e.requiredContent;(d=F.filter.check(d))&&!e.isSpacer&&C++;return d});5<C&&(G=G.concat([E(),s()]));CKEDITOR.tools.array.forEach(z,function(d){d.isSpacer||b++;5<C&&b>=C/2?G[2].children.push(d):G[0].children.push(d)});CKEDITOR.tools.array.forEach(G,function(d){d.isSpacer||(d=d.children,d[d.length-1].isSpacer&&d.pop())});return{title:J.title,minWidth:1===G.length?205:410,minHeight:50,contents:[{id:"info",label:J.title,accessKey:"I",elements:[{type:"hbox",widths:1===G.length?["100%"]:["40%","5%","40%"],children:G}]}],getModel:function(d){return CKEDITOR.plugins.tabletools.getSelectedCells(d.getSelection())},onShow:function(){var d=this.getModel(this.getParentEditor());this.setupContent(d)},onOk:function(){for(var g=this._.editor.getSelection(),f=g.createBookmarks(),l=this.getParentEditor(),k=this.getModel(l),h=0;h<k.length;h++){this.commitContent(k[h])}l.forceNextSelectionCheck();g.selectBookmarks(f);l.selectionChange()},onLoad:function(){var d={};this.foreach(function(e){e.setup&&e.commit&&(e.setup=CKEDITOR.tools.override(e.setup,function(f){return function(){f.apply(this,arguments);d[e.id]=e.getValue()}}),e.commit=CKEDITOR.tools.override(e.commit,function(f){return function(){d[e.id]!==e.getValue()&&f.apply(this,arguments)}}))})}}});