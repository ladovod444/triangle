/*
 *  Copyright 2025.  Baks.dev <admin@baks.dev>
 *  
 *  Permission is hereby granted, free of charge, to any person obtaining a copy
 *  of this software and associated documentation files (the "Software"), to deal
 *  in the Software without restriction, including without limitation the rights
 *  to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 *  copies of the Software, and to permit persons to whom the Software is furnished
 *  to do so, subject to the following conditions:
 *  
 *  The above copyright notice and this permission notice shall be included in all
 *  copies or substantial portions of the Software.
 *  
 *  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 *  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 *  FITNESS FOR A PARTICULAR PURPOSE AND NON INFRINGEMENT. IN NO EVENT SHALL THE
 *  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 *  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 *  OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 *  THE SOFTWARE.
 */

var containers=document.querySelectorAll(".draggable-zone");const form=document.forms.order_delivery_filter_form;form.addEventListener("change",()=>{setTimeout(()=>{form.submit()},300)});function getToken(url,ctx){return new Promise((resolve,reject)=>{fetch(url,{method:"POST",headers:new Headers({"Content-Type":"application/json"}),body:JSON.stringify(ctx)}).then(res=>{if(!res.ok){throw new Error(`Unexpected status code ${res.status}`)}return res.json()}).then(data=>{resolve(data.token)}).catch(err=>{reject(err)})})}executeFunc(function P8X1I2diQ4(){if(typeof Droppable!=="object"||typeof bootstrap!=="object"){return false}const modal=document.getElementById("modal");const modal_bootstrap=bootstrap.Modal.getOrCreateInstance(modal);var droppable=new Droppable.default(containers,{draggable:".draggable",dropzone:".draggable-zone",handle:".draggable .draggable-handle",mirror:{appendTo:"body",constrainDimensions:true}});let droppableOrigin;let droppableLevel;let droppableRestrict;let toDroppable;droppable.on("drag:start",e=>{document.body.style.overflow="hidden"});droppable.on("drag:over",e=>{});droppable.on("drag:stop",async e=>{containers.forEach(c=>{c.classList.remove("draggable-dropzone--occupied")});document.body.style.overflow="auto";let level=e.sourceContainer.getAttribute("data-status");let id=e.originalSource.id;if(e.sourceContainer.getAttribute("data-status")!==droppableLevel&&droppableRestrict!=="restricted"){modal.innerHTML='<div class="modal-dialog modal-dialog-centered"><div class="d-flex justify-content-center w-100"><div class="spinner-border text-light" role="status"><span class="visually-hidden">Loading...</span></div></div></div>';modal_bootstrap.show();fetch("/admin/order/"+droppableLevel+"/"+id,{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(response){if(response.status===302||response.status===404){modal_bootstrap.hide();return true}if(response.status===200){return response.text()}let $dangerOrderToast='{ "type":"danger" , '+'"header":"Ошибка при изменении"  , '+'"message" : "Ошибка при изменении статуса заказа!" }';createToast(JSON.parse($dangerOrderToast));let json=response.json();json.then(result=>{if(result.type&&result.header&&result.message){createToast(result)}});modal_bootstrap.hide();return false}).then(function(html){if(html===true){submitLink("/admin/order/status/"+droppableLevel+"/"+id);modal_bootstrap.hide();return}if(html){const modal=document.getElementById("modal");modal.innerHTML=html;let lazy=document.createElement("script");lazy.src="/assets/js/lazyload.min.js?v={{ version }}";document.head.appendChild(lazy);modal.querySelectorAll("form").forEach(function(forms){forms.addEventListener("submit",function(event){event.preventDefault();submitModalForm(forms);return false})})}}).catch(function(err){console.warn("Something went wrong.",err)});console.log(level+" => "+droppableLevel)}});droppable.on("droppable:dropped",e=>{toDroppable=e.dropzone;droppableLevel=e.dropzone.getAttribute("data-status");droppableRestrict=e.dropzone.getAttribute("data-level");if(droppableRestrict==="restricted"){e.cancel()}});return true});