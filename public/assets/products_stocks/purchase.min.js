executeFunc(function productStocsPurchase(){ChangePurchaseForm=document.forms.purchase_product_stock_form;if(typeof ChangePurchaseForm==="undefined"){return false}var object_category=document.getElementById(ChangePurchaseForm.name+"_category");if(object_category===null){return false}object_category.addEventListener("change",function(){changeObjectCategory(ChangePurchaseForm)},false);let numberElement=document.getElementById(ChangePurchaseForm.name+"_invariable_number");numberElement.focus();numberElement.addEventListener("keydown",function(event){if(event.key==="Enter"){event.preventDefault();var categoryElementSelect2=document.getElementById(ChangePurchaseForm.name+"_category_select2");if(categoryElementSelect2){categoryElementSelect2.click()}else{var categoryElementSelect=document.getElementById(ChangePurchaseForm.name+"_category");categoryElementSelect2.click()}}});let $addButtonStock=document.getElementById(ChangePurchaseForm.name+"_addPurchase");$addButtonStock.addEventListener("click",addProductPurchase,false);document.getElementById(ChangePurchaseForm.name+"_purchase").addEventListener("click",function(event){if(ChangePurchaseForm.querySelectorAll(".item-collection-product")?.length<=0){let $errorFormHandlerProducts=JSON.stringify({type:"danger",header:"Добавить лист закупки продукции",message:"В списке нет ни одного элемента продукции"});createToast(JSON.parse($errorFormHandlerProducts));return false}let elementTotal=document.getElementById(ChangePurchaseForm.name+"_preTotal");if(elementTotal){if(elementTotal.value.trim()!==""){let $errorFormHandlerProducts=JSON.stringify({type:"danger",header:"Добавить лист закупки продукции",message:'Вы не добавили продукцию в общий список кликнув "+ Добавить в закупку"'});createToast(JSON.parse($errorFormHandlerProducts));return false}}if(event.key!=="Enter"){submitModalForm(ChangePurchaseForm)}return false});return true});executeFunc(function _______________productStocsPurchase(){return true;var object_product=document.getElementById("purchase_product_stock_form_preProduct");if(!object_product){return false}object_product.addEventListener("change",changeObjectProduct,false);let $addButtonStock=document.getElementById("purchase_product_stock_form_addPurchase");$addButtonStock.addEventListener("click",addProductPurchase,false);let purchaseForm=document.forms.purchase_product_stock_form;let forms=object_product.closest("form");document.getElementById("purchase_product_stock_form_purchase").addEventListener("click",function(event){if(event.key!=="Enter"){submitModalForm(forms)}return false});document.getElementById("purchase_product_stock_form_preTotal").addEventListener("keydown",function(event){if(event.key==="Enter"){addProductPurchase()}});document.getElementById("purchase_product_stock_form_invariable_number").addEventListener("keydown",function(event){if(event.key==="Enter"){event.preventDefault();var input_preProduct=document.getElementById("purchase_product_stock_form_select2");if(input_preProduct){document.getElementById("purchase_product_stock_form_select2").click()}}});return true});async function changeObjectCategory(forms){disabledElementsForm(forms);document.getElementById("preProduct")?.classList.add("d-none");document.getElementById("preOffer")?.classList.add("d-none");document.getElementById("preVariation")?.classList.add("d-none");document.getElementById("preModification")?.classList.add("d-none");document.getElementById("purchase_product_stock_form_addPurchase")?.classList.replace("btn-outline-primary","btn-outline-secondary");const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var result=parser.parseFromString(data,"text/html");let preProduct=result.getElementById("preProduct");if(preProduct){preProduct.querySelectorAll(".is-invalid").forEach(el=>{el.classList.remove("is-invalid")});preProduct.querySelectorAll(".invalid-feedback").forEach(el=>{el.remove()})}document.getElementById("preProduct").replaceWith(preProduct);preProduct?document?.getElementById("product")?.replaceWith(preProduct):preProduct.innerHTML="";let replacer=document.getElementById(forms.name+"_preProduct");replacer&&replacer.type!=="hidden"?preProduct.classList.remove("d-none"):null;if(replacer){if(replacer.tagName==="SELECT"){new NiceSelect(replacer,{searchable:true});let focus=document.getElementById(forms.name+"_preProduct_select2");focus?focus.click():null}}let preOffer=document.getElementById("preOffer");preOffer?preOffer.innerHTML="":null;let preVariation=document.getElementById("preVariation");preVariation?preVariation.innerHTML="":null;let preModification=document.getElementById("preModification");preModification?preModification.innerHTML="":null;if(replacer){replacer.addEventListener("change",function(event){changeObjectProduct(forms);return false})}}enableElementsForm(forms)})}async function changeObjectProduct(forms){disabledElementsForm(forms);document.getElementById("preOffer")?.classList.add("d-none");document.getElementById("preVariation")?.classList.add("d-none");document.getElementById("preModification")?.classList.add("d-none");document.getElementById("purchase_product_stock_form_addPurchase")?.classList.replace("btn-outline-primary","btn-outline-secondary");const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var result=parser.parseFromString(data,"text/html");let preOffer=result.getElementById("preOffer");preOffer?document.getElementById("preOffer").replaceWith(preOffer):preOffer.innerHTML="";if(preOffer){preOffer.querySelectorAll(".is-invalid").forEach(el=>{el.classList.remove("is-invalid")});preOffer.querySelectorAll(".invalid-feedback").forEach(el=>{el.remove()});let replaceOfferId=forms.name+"_preOffer";let replacer=document.getElementById(replaceOfferId);replacer&&replacer.type!=="hidden"?preOffer.classList.remove("d-none"):null;if(replacer.tagName==="SELECT"){new NiceSelect(replacer,{searchable:true});let focus=document.getElementById(forms.name+"_preOffer_select2");focus?focus.click():null}else{selectTotal(forms)}}let preVariation=document.getElementById("preVariation");preVariation?preVariation.innerHTML="":null;let preModification=document.getElementById("preModification");preModification?preModification.innerHTML="":null;let offerChange=document.getElementById(forms.name+"_preOffer");if(offerChange){offerChange.addEventListener("change",function(event){changeObjectOffer(forms);return false})}}enableElementsForm(forms)})}async function changeObjectOffer(forms){disabledElementsForm(forms);document.getElementById("preVariation")?.classList.add("d-none");document.getElementById("preModification")?.classList.add("d-none");document.getElementById("purchase_product_stock_form_addPurchase")?.classList.replace("btn-outline-primary","btn-outline-secondary");const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var result=parser.parseFromString(data,"text/html");let preVariation=result.getElementById("preVariation");if(preVariation){preVariation.querySelectorAll(".is-invalid").forEach(el=>{el.classList.remove("is-invalid")});preVariation.querySelectorAll(".invalid-feedback").forEach(el=>{el.remove()});document.getElementById("preVariation").replaceWith(preVariation);let replacer=document.getElementById(forms.name+"_preVariation");replacer&&replacer.type!=="hidden"?preVariation.classList.remove("d-none"):null;if(replacer){if(replacer.tagName==="SELECT"){new NiceSelect(replacer,{searchable:true});let focus=document.getElementById(forms.name+"_preVariation_select2");focus?focus.click():null;replacer.addEventListener("change",function(event){changeObjectVariation(forms);return false})}else{selectTotal(forms)}}}let preModification=document.getElementById("preModification");preModification?preModification.innerHTML="":null}enableElementsForm(forms)})}async function changeObjectVariation(forms){disabledElementsForm(forms);document.getElementById("preModification")?.classList.add("d-none");document.getElementById("purchase_product_stock_form_addPurchase")?.classList.replace("btn-outline-primary","btn-outline-secondary");const data=new FormData(forms);data.delete(forms.name+"[_token]");await fetch(forms.action,{method:forms.method,cache:"no-cache",credentials:"same-origin",headers:{"X-Requested-With":"XMLHttpRequest"},redirect:"follow",referrerPolicy:"no-referrer",body:data}).then(response=>{if(response.status!==200){return false}return response.text()}).then(data=>{if(data){var parser=new DOMParser;var result=parser.parseFromString(data,"text/html");let preModification=result.getElementById("preModification");if(preModification){preModification.querySelectorAll(".is-invalid").forEach(el=>{el.classList.remove("is-invalid")});preModification.querySelectorAll(".invalid-feedback").forEach(el=>{el.remove()});document.getElementById("preModification").replaceWith(preModification);let replacer=document.getElementById(forms.name+"_preModification");replacer&&replacer.type!=="hidden"?preModification.classList.remove("d-none"):null;if(replacer){if(replacer.tagName==="SELECT"){new NiceSelect(replacer,{searchable:true});let focus=document.getElementById(forms.name+"_preModification_select2");focus?focus.click():null;replacer.addEventListener("change",function(event){selectTotal(forms);return false})}else{selectTotal(forms)}}}}enableElementsForm(forms)})}function selectTotal(forms){setTimeout(function(){let focusTotal=document.getElementById(ChangePurchaseForm.name+"_preTotal");document.getElementById(ChangePurchaseForm.name+"_addPurchase")?.classList.replace("btn-outline-secondary","btn-outline-primary");focusTotal.value="";focusTotal?focusTotal.focus():null;focusTotal.addEventListener("keydown",enterTotalElement)},100)}function enterTotalElement(event){if(event.key==="Enter"){event.preventDefault();addProductPurchase();document.removeEventListener("keydown",enterTotalElement)}}function _____changeObjectProduct(){let replaceId="purchase_product_stock_form_preOffer";const requestModalName=new XMLHttpRequest;requestModalName.responseType="document";let purchaseForm=document.forms.purchase_product_stock_form;disabledElementsForm(purchaseForm);let formData=new FormData;formData.append(this.getAttribute("name"),this.value);requestModalName.open(purchaseForm.getAttribute("method"),purchaseForm.getAttribute("action"),true);requestModalName.setRequestHeader("X-Requested-With","XMLHttpRequest");requestModalName.addEventListener("readystatechange",function(){if(requestModalName.readyState===4&&requestModalName.status===200){let result=requestModalName.response.getElementById("preOffer");document.getElementById("preOffer").replaceWith(result);let replacer=document.getElementById(replaceId);if(replacer.tagName==="SELECT"){new NiceSelect(replacer,{searchable:true,id:"select2-"+replaceId});let offerChange=document.getElementById("purchase_product_stock_form_preOffer");if(offerChange){offerChange.addEventListener("change",changeObjectOffer,false);let focus=document.getElementById(replaceId+"_select2");focus?focus.click():null}}}enableElementsForm(purchaseForm);return false});requestModalName.send(formData)}function _____changeObjectOffer(){let replaceId="purchase_product_stock_form_preVariation";const requestModalName=new XMLHttpRequest;requestModalName.responseType="document";let purchaseForm=document.forms.purchase_product_stock_form;disabledElementsForm(purchaseForm);let formData=new FormData;formData.append(this.getAttribute("name"),this.value);requestModalName.open(purchaseForm.getAttribute("method"),purchaseForm.getAttribute("action"),true);requestModalName.setRequestHeader("X-Requested-With","XMLHttpRequest");requestModalName.addEventListener("readystatechange",function(){if(requestModalName.readyState===4&&requestModalName.status===200){let result=requestModalName.response.getElementById("preVariation");document.getElementById("preVariation").replaceWith(result);let replacer=document.getElementById(replaceId);let select2=document.getElementById(replaceId+"_select2");if(select2){select2.remove()}if(replacer.tagName==="SELECT"){new NiceSelect(document.getElementById(replaceId),{searchable:true,id:"select2-"+replaceId});let offerVariation=document.getElementById("purchase_product_stock_form_preVariation");if(offerVariation){offerVariation.addEventListener("change",changeObjectVariation,false)}let focus=document.getElementById(replaceId+"_select2");focus?focus.click():null}}enableElementsForm(purchaseForm);return false});requestModalName.send(formData)}function _____changeObjectVariation(){let replaceId="purchase_product_stock_form_preModification";const requestModalName=new XMLHttpRequest;requestModalName.responseType="document";let purchaseForm=document.forms.purchase_product_stock_form;disabledElementsForm(purchaseForm);let formData=new FormData;formData.append(this.getAttribute("name"),this.value);requestModalName.open(purchaseForm.getAttribute("method"),purchaseForm.getAttribute("action"),true);requestModalName.setRequestHeader("X-Requested-With","XMLHttpRequest");requestModalName.addEventListener("readystatechange",function(){if(requestModalName.readyState===4&&requestModalName.status===200){let result=requestModalName.response.getElementById("preModification");document.getElementById("preModification").replaceWith(result);let replacer=document.getElementById(replaceId);if(replacer.tagName==="SELECT"){new NiceSelect(document.getElementById(replaceId),{searchable:true,id:"select2-"+replaceId})}let focus=document.getElementById(replaceId+"_select2");focus?focus.click():null;let offerModification=document.getElementById("purchase_product_stock_form_preModification");if(offerModification){offerModification.addEventListener("change",event=>{setTimeout(function initBootstrap(){document.getElementById("purchase_product_stock_form_preTotal").focus()},100)})}}enableElementsForm(purchaseForm);return false});requestModalName.send(formData)}var collectionProductPurshase=new Map;function addProductPurchase(){const dynamicElements=["preProduct","preOffer","preVariation","preModification"];let $blockCollectionStock=document.getElementById("collectionStock");let $errorFormHandler=null;let header="Добавить лист закупки продукции";let $preTotal=document.getElementById(ChangePurchaseForm.name+"_preTotal");let $TOTAL=$preTotal.value*1;if($TOTAL===undefined||$TOTAL<1){$errorFormHandler=JSON.stringify({type:"danger",header:header,message:"Не заполнено количество"})}let $number=document.getElementById(ChangePurchaseForm.name+"_invariable_number");if($number.value.length===0){$errorFormHandler=JSON.stringify({type:"danger",header:header,message:"Не заполнен номер закупки"})}let $preCategory=document.getElementById(ChangePurchaseForm.name+"_category");let $preProduct=document.getElementById(ChangePurchaseForm.name+"_preProduct");let $preOffer=document.getElementById(ChangePurchaseForm.name+"_preOffer");let $preVariation=document.getElementById(ChangePurchaseForm.name+"_preVariation");let $preModification=document.getElementById(ChangePurchaseForm.name+"_preModification");if($preCategory.value.length===0){$errorFormHandler=JSON.stringify({type:"danger",header:header,message:$preCategory.options[0].textContent})}dynamicElements.forEach(id=>{const element=document.getElementById(ChangePurchaseForm.name+"_"+id);if(element&&element.tagName==="SELECT"&&element.value.length===0){const message=element.options[0].textContent;$errorFormHandler=JSON.stringify({type:"danger",header:header,message:message})}});const mapKey=[$preProduct,$preOffer,$preVariation,$preModification].map(item=>item?item.value:"").join("");if(collectionProductPurshase.has(mapKey)){$errorFormHandler=JSON.stringify({type:"danger",header:header,message:"Продукция уже добавлена в список"})}if($errorFormHandler){createToast(JSON.parse($errorFormHandler));return false}let $addButtonStock=document.getElementById(ChangePurchaseForm.name+"_addPurchase");let newForm=$addButtonStock.dataset.prototype;let index=$addButtonStock.dataset.index*1;newForm=newForm.replace(/__product__/g,index);let stockDiv=document.createElement("div");stockDiv.classList.add("item-collection-product");stockDiv.classList.add("w-100");stockDiv.innerHTML=newForm;$blockCollectionStock.append(stockDiv);let $total=stockDiv.querySelector("#"+ChangePurchaseForm.name+"_product_"+index+"_total");$total.value=$preTotal.value;let $product=stockDiv.querySelector("#"+ChangePurchaseForm.name+"_product_"+index+"_product");$product.value=$preProduct.value;let productIndex=$preProduct.selectedIndex;let $productName=$preProduct.options[productIndex].textContent;let $offerName="";if($preOffer){let $offer=stockDiv.querySelector("#"+ChangePurchaseForm.name+"_product_"+index+"_offer");$offer.value=$preOffer?.value;let offerIndex=$preOffer.selectedIndex;$offerName=$preOffer.tagName==="SELECT"?'&nbsp; <small class="text-muted fw-normal">'+document.querySelector('label[for="'+$preOffer.id+'"]').textContent+"</small> "+$preOffer.options[offerIndex].textContent:""}let $variationName="";if($preVariation){let $variation=stockDiv.querySelector("#"+ChangePurchaseForm.name+"_product_"+index+"_variation");$variation.value=$preVariation.value;let variationIndex=$preVariation.selectedIndex;$variationName=$preVariation.tagName==="SELECT"?'&nbsp; <small class="text-muted fw-normal">'+document.querySelector('label[for="'+$preVariation.id+'"]').textContent+"</small> "+$preVariation.options[variationIndex].textContent:""}let $modificationName="";if($preModification){let $modification=stockDiv.querySelector("#"+ChangePurchaseForm.name+"_product_"+index+"_modification");$modification.value=$preModification.value;let modificationIndex=$preModification.selectedIndex;$modificationName=$preModification.tagName==="SELECT"?'&nbsp; <small class="text-muted fw-normal">'+document.querySelector('label[for="'+$preModification.id+'"]').textContent+"</small> "+$preModification.options[modificationIndex].textContent:""}let $productTextBlock=stockDiv.querySelector("#product-text-"+index);$productTextBlock.innerHTML=$productName+$offerName+$variationName+$modificationName+"&nbsp; : &nbsp;"+$total.value+" шт.";$preTotal.value=null;stockDiv.querySelector(".del-item-product").addEventListener("click",function(){this.closest(".item-collection-product").remove();index=$addButtonStock.dataset.index*1;$addButtonStock.dataset.index=(index-1).toString();collectionProductPurshase.delete(mapKey)});$addButtonStock.dataset.index=(index+1).toString();dynamicElements.forEach(id=>{if(id==="preProduct"){return}const element=document.getElementById(id);if(element){element.innerHTML="";element.classList.add("d-none")}});collectionProductPurshase.set(mapKey,$total.value);var limit_faaJUfW=1e3;setTimeout(function init_TQCmNQtx(){var input_preProduct_select=document.getElementById(ChangePurchaseForm.name+"_preProduct_select2");if(input_preProduct_select){input_preProduct_select.click();return}var input_preProduct=document.getElementById(ChangePurchaseForm.name+"_preProduct");if(input_preProduct){document.getElementById(ChangePurchaseForm.name+"_preProduct_select2");return}if(limit_faaJUfW>1e3){return}limit_faaJUfW=limit_faaJUfW*2;setTimeout(init_TQCmNQtx,limit_faaJUfW)},100)}