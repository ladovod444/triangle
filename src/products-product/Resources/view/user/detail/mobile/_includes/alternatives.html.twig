{# БЛОК АЛТЕРНАТИВ ПРОДУКТА #}

<h3 class="fs-6 text-uppercase fw-bold mb-3">
    альтернатива
</h3>

<table class="table table-borderless link-parent align-middle fs-11 mb-0">

    <thead class="table-warning fs-10" style="letter-spacing:normal!important;">
    <tr>
        <th class="fw-normal radius ps-3" scope="col">Наименование</th>
        <th class="fw-normal text-center" scope="col">Наличие</th>
        <th class="fw-normal text-center" scope="col">Стоимость</th>
        <th class="fw-normal text-center pe-3" scope="col">Купить</th>
    </tr>
    </thead>

    {# @TODO для тестирования #}
    {#     {% set alternative = null %} #}

    {% if alternative %}

        {% set alternativeLength = alternative|length %}

        {% for k,alt in alternative %}

            {# Рассчет количества #}
            {% set alternativeQuantity = '' %}
            {% set inStock = true %}
            {% set quantity = alt.quantity %}

            {% if quantity == 0 %}
                {% set alternativeQuantity = 'Нет в наличии' %}
                {% set inStock = false %}
            {% elseif quantity > 20 %}
                {% set alternativeQuantity = '> 20 шт.' %}
            {% elseif quantity < 20 %}
                {% set alternativeQuantity = '< 20 шт.' %}
            {% else %}
                {% set alternativeQuantity = (quantity)~' шт.' %}
            {% endif %}

            {# Свойства для алтернативных предложений #}
            {% set alternativeProperties = alt.category_section_field|json_decode %}

            {# Рассчет скидки #}
            {% set discount = false %}

            {% if alt.price and alt.product_old_price > alt.price %}
                {% set discount = (((alt.product_old_price - alt.price) / alt.product_old_price) * 100)|round %}
                {#    {% set discount = (100 - (alt.price / (oldPrice / 100)))|round %} #}
            {% endif %}


            <tbody>

            <tr class="{{ k + 1 == alternativeLength ? '' : 'border-bottom' }} ">

                <th class="fw-normal py-2 " scope="row">

                    {# Наименование / Размер #}
                    <a class="text-black fw-bold text-decoration-none "
                       href="{{ path('products-product:user.detail', {
                           category: alt.category_url,
                           url: alt.product_url,
                           offer: alt.product_offer_value,
                           variation: alt.product_variation_value,
                           modification: alt.product_modification_value,
                           postfix: (alt.product_modification_postfix ?: alt.product_variation_postfix ?: alt.product_offer_postfix ?: null )|replace({ '/': '-' }),
                       }) }}">
                        {{ alt.product_name }}
                        {{ alt.product_variation_value|call_twig_func(alt.product_variation_reference~'_render')
                        ~ alt.product_modification_value|call_twig_func(alt.product_modification_reference~'_render') }}
                        {{ alt.product_offer_value|call_twig_func(alt.product_offer_reference~'_render') }}
                        {{ alt.product_modification_postfix }}
                    </a>


                    {% if date() < alt.active_from|date_modify("+1 month") %}
                        <a href="#" class="btn btn-success fw-bold rounded-5 fs-8 py-1 px-2">
                            НОВИНКА
                        </a>
                    {% endif %}

                    {# @TODO пока не реализуем #}
                    {#                <a href="#" class="btn text-white btn-warning fw-bold rounded-5 fs-8 py-1 px-2 ms-1"> #}
                    {#                    ТОП #}
                    {#                </a> #}
                </th>

                {% if inStock == true %}

                    <td class="fw-normal py-2 px-0 text-center"> {{ alternativeQuantity }} </td>

                    <td class=" py-2 text-center fw-bold fs-12">

                        {% if discount %}
                            <a href="#" class="btn text-white btn-danger fw-bold rounded-5 fs-11 py-1 px-2 me-2">
                                - {{ discount }} %
                            </a>
                        {% endif %}

                        <p class="m-0">{{ money(alt.price, alt.currency) }}</p>
                    </td>

                    <td class="  py-2 ">
                        <div class="d-flex">
                            {# В КОРЗИНУ #}
                            {% include Template('/public/'~(baks_settings.device ?: 'pc')~'/_includes/add_basket.html.twig') with {
                                'model_event': alt.event,
                                'product_offer': alt.product_offer_uid,
                                'product_variation': alt.product_variation_uid,
                                'product_modification': alt.product_modification_uid,
                            } only %}

                            {# В ИЗБРАННОЕ #}
                            {% include Template('/public/'~(baks_settings.device ?: 'pc')~'/_includes/add_favorites.html.twig') %}

                            {#                            <a href="#" aria-label="Иконка перехода в корзину"> #}
                            {#                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="lightgray" #}
                            {#                                     class="bi bi-cart-fill " viewBox="0 0 16 16"> #}
                            {#                                    <path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4zm-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2zm7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2z"/> #}
                            {#                                </svg> #}
                            {#                            </a> #}
                            {#                            #}
                            {#                            <a href="#" aria-label="Иконка добавления в избранное"> #}
                            {#                                <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="lightgray" #}
                            {#                                     class="bi bi-heart-fill ms-1" viewBox="0 0 16 16"> #}
                            {#                                    <path fill-rule="evenodd" #}
                            {#                                          d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314z"/> #}
                            {#                                </svg> #}
                            {#                            </a> #}
                        </div>
                    </td>

                {% else %}

                    <td class="fw-normal py-2 px-0 text-center"> Нет в наличии</td>

                    <td class="fw-normal py-2 px-0 text-center"> Цена по запросу</td>

                    <td class="py-2">

                        {# В ИЗБРАННОЕ #}
                        {% include Template('/public/'~(baks_settings.device ?: 'pc')~'/_includes/add_favorites.html.twig') %}
                    </td>

                {% endif %}

            </tr>
            </tbody>
        {% endfor %}
    {% endif %}

</table>