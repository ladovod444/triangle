{# БЛОК АЛТЕРНАТИВ ПРОДУКТА #}

<h3 class="fs-18 text-uppercase fw-bold mb-4">
    Альтернатива
</h3>

<div class="border p-1 rounded-4">

    <table class="table table-borderless link-parent align-middle fs-12 mb-0">
        <thead class="table-warning " style="letter-spacing:normal!important;">

        <tr>
            <th class="fw-normal px-3 radius" scope="col">Наименование</th>
            <th class="fw-normal text-center" scope="col">Размер</th>
            <th class="fw-normal text-center" scope="col">Характеристики</th>
            <th class="fw-normal text-center" scope="col">Наличие</th>
            <th class="fw-normal text-center" scope="col">Стоимость, шт.</th>
            <th class="fw-normal text-center" scope="col">Купить</th>
        </tr>

        </thead>

        {# @TODO для тестирования #}
        {#     {% set alternative = null %} #}

        {% if alternative %}

        {% set alternativeLength = alternative|length %}

        {% for k,alt in alternative %}

            {# Рассчет количества #}
            {% set alternativeQuantity = '' %}
            {% set inStock = true %}
            {% set quantity = alt.quantity %}

            {% if quantity == 0 %}
                {% set alternativeQuantity = 'Нет в наличии' %}
                {% set inStock = false %}
            {% elseif quantity > 20 %}
                {% set alternativeQuantity = 'Более 20 шт.' %}
            {% elseif quantity < 20 %}
                {% set alternativeQuantity = 'Менее 20 шт.' %}
            {% else %}
                {% set alternativeQuantity = (quantity)~' шт.' %}
            {% endif %}

            {# Свойства для алтернативных предложений #}
            {% set alternativeProperties = alt.category_section_field|json_decode %}

            {# Рассчет скидки #}
            {% set discount = false %}

            {% if alt.price and alt.product_old_price > alt.price %}
                {% set discount = (((alt.product_old_price - alt.price) / alt.product_old_price) * 100)|round %}
                {#    {% set discount = (100 - (alt.price / (oldPrice / 100)))|round %} #}
            {% endif %}

            <tbody>

            <tr class="{{ k + 1 == alternativeLength ? '' : 'border-bottom' }} ">

                {# НАИМЕНОВАНИЕ #}
                <th class="fw-normal py-3" scope="row">
                    <div class="d-flex justify-content-between">

                        <a class="text-black fw-bold text-decoration-none "
                           href="{{ path('products-product:user.detail', {
                               category: alt.category_url,
                               url: alt.product_url,
                               offer: alt.product_offer_value,
                               variation: alt.product_variation_value,
                               modification: alt.product_modification_value,
                               postfix: (alt.product_modification_postfix ?: alt.product_variation_postfix ?: alt.product_offer_postfix ?: null )|replace({ '/': '-' }),
                           }) }}">
                            {{ alt.product_name }}
                        </a>

                        <div class="d-flex align-items-center text-nowrap">

                            {# Если дата начала активности меньше 1 месяца - НОВИНКА  #}
                            {% if date() < alt.active_from|date_modify("+1 month") %}
                                <a href="#" class="btn btn-success fw-bold rounded-5 fs-10 py-1 px-2 ms-1">
                                    НОВИНКА
                                </a>
                            {% endif %}

                            {# @TODO пока не реализуем #}
                            {# <a href="#" class="btn text-white btn-warning fw-bold rounded-5 fs-10 py-1 px-2 ms-1"> #}
                            {# ТОП #}
                            {# </a> #}
                        </div>

                    </div>
                </th>

                {# РАЗМЕР #}
                <td class="fw-normal py-3  text-center">
                    {{ alt.product_variation_value|call_twig_func(alt.product_variation_reference~'_render')
                    ~ alt.product_modification_value|call_twig_func(alt.product_modification_reference~'_render') }}
                    {{ alt.product_offer_value|call_twig_func(alt.product_offer_reference~'_render') }}
                    {{ alt.product_modification_postfix }}
                </td>

                {# ХАРАКТЕРИСТИКИ #}
                <td class="d-flex py-3 gap-2 align-items-center">
                    {% for property in alternativeProperties %}
                        {{ property.field_value|call_twig_func(property.field_type~'_render') }}
                    {% endfor %}
                </td>

                {# НАЛИЧИЕ, СТОИМОСТЬ, СКИДКА, КНОПКИ "ИЗБРАННОЕ/КОРЗИНА" #}
                {% if inStock == true %}

                    <td class="py-3 fw-bold text-center"> {{ alternativeQuantity }}</td>

                    <td class="py-3 text-center fw-bold">

                        {% if discount %}

                            <a href="#" class="btn text-white btn-danger fw-bold rounded-5 fs-11 py-1 px-2 me-2">
                                - {{ discount }} %
                            </a>

                        {% endif %}

                        {{ money(alt.price, alt.currency) }}

                    </td>

                    <td class="py-3 text-end">

                        {# В КОРЗИНУ #}
                        {% include Template('/public/'~(baks_settings.device ?: 'pc')~'/_includes/add_basket.html.twig') with {
                            'model_event': alt.event,
                            'product_offer': alt.product_offer_uid,
                            'product_variation': alt.product_variation_uid,
                            'product_modification': alt.product_modification_uid,
                        } only %}

                        {# В ИЗБРАННОЕ #}
                        {% include Template('/public/'~(baks_settings.device ?: 'pc')~'/_includes/add_favorites.html.twig') %}

                    </td>

                {% else %}

                    <td class="text-danger fw-bold py-3 text-center">Нет в наличии</td>

                    <td class="text-danger fw-bold py-3 text-center">Цена по запросу</td>

                    <td class="py-3 text-end">

                        {# В ИЗБРАННОЕ #}
                        {% include Template('/public/'~(baks_settings.device ?: 'pc')~'/_includes/add_favorites.html.twig') %}

                    </td>

                {% endif %}

            </tr>
            </tbody>

        {% endfor %}
    </table>

    {% else %}

        </table>

        <div class="mt-3 alert alert-danger rounded-4 pb-0 w-100" role="alert">
            <div class="d-flex align-items-baseline gap-3">
                <div>
                    <div class="icon rounded-circle bg-contain p-2 bg-danger text-white small"
                         style="width: 10px; height: 10px;">
                        <span class="small">!</span>
                    </div>
                </div>

                <div class="small lh-1">
                    <p>К сожалению альтернативные варианты не найдены</p>
                </div>
            </div>
        </div>

    {% endif %}
</div>



